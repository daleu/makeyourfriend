doctype html(lang='en')
head
    title MY STORIES
    link(rel="shortcut icon" href="/images/logo_v4_100.png")
    meta(charset='utf-8')
    meta(name='viewport', content='width=device-width, initial-scale=1')
    link(rel='stylesheet', href='/css/bootstrap.min.css')
    link(rel='stylesheet', href='/style/style.css')
    link(rel='stylesheet', href='/css/w3.css')
    link(rel='stylesheet', href='/style/datepicker.min.css')
    link(rel='stylesheet', href='/css/font-awesome.min.css')
    script(src='/js/jquery.min.js')
    script(src='/js/datepicker.min.js')
    script(src='/js/datepicker.en.js')
    script(src='/js/bootstrap.min.js')
    script(src='/js/jquery.validate.min.js')
body
    nav.navbar.navbar-default.navbar-fixed-top
        .container-fluid(style='background-color: rgb(42, 124, 82) important;')
            .navbar-header
                button.navbar-toggle.collapsed(type='button', data-toggle='collapse', data-target='#bs-example-navbar-collapse-1', aria-expanded='false')
                    span.sr-only Toggle navigation
                    span.icon-bar
                    span.icon-bar
                    span.icon-bar
                a.navbar-brand(href='/')
                    img(alt="Brand" src="/images/logo_v4_100.png" height='60px;' style='margin-top:5px !important;')
            #bs-example-navbar-collapse-1.collapse.navbar-collapse
                ul.nav.navbar-nav
                    li
                        a(href='/')
                            span.fa.fa-home
                            |  HOME
                ul.nav.navbar-nav.navbar-right
                    li
                        a(href='/logout')
                            span.fa.fa-sign-out
                            |  SIGN OUT
                    li.dropdown
                        a.dropdown-toggle(href='#', data-toggle='dropdown', role='button', aria-haspopup='true', aria-expanded='false')
                            | LANGUAGE
                            span.fa.fa-chevron-down(style='margin-left:10px;')
                        ul.dropdown-menu
                            li
                                a(href='/register-ca') CATALÃ€
                            li
                                a(href='#') CASTELLANO
                            li
                                a(href='#') ENGLISH
    //FUNCTION TO PUT GOOD DATE
    - function dateToYMD(date) {
    -   var d = date.getDate();
    -   var m = date.getMonth() + 1;
    -   var y = date.getFullYear();
    -   var h = date.getHours();
    -   var min = date.getMinutes();
    -   var s = date.getSeconds();
    -   return (m <= 9 ? '0' + m : m) + '/' + (d <= 9 ? '0' + d : d) + '/' + y + " " + (h <= 9 ? '0' + h : h) + ":" + (min <= 9 ? '0' + min : min) + ":" + (s <= 9 ? '0' + s : s);
    - }

    .w3-container.w3-center
        .w3-col.l4
            each post,index in posts
                if(index % 3 == 0)
                    .w3-card-4.w3-white(id="delete" + post.uuid)
                        if(post.foto != 'nothing')
                            img(src= post.foto)
                        p(style="margin-left: 10px; margin-top: 10px;") BY &nbsp;
                            b= post.usuari
                            p(style="margin-left: 20px; margin-top: 10px; font-color: #434343;")= "ON " + dateToYMD(new Date(post.date))
                        if(post.description != 'nothing')
                            .w3-container.w3-center(style="width: 95%")
                                hr
                                b DESCRIPTION
                                p(style='word-wrap: break-word;text-align: left;')= post.description
                                p LIKES:
                                p(id="likes" + post.uuid)= post.likes.low
                                if(post.liked.low == 0)
                                    button.w3-button.w3-padding-large.w3-black.w3-border.w3-right(id="like" + post.uuid onclick='like("' + post.uuid + '");', style='margin-bottom: 15px;')
                                        span.fa.fa-pencil
                                        b &nbsp; &nbsp; LIKE
                                    button.w3-button.w3-padding-large.w3-black.w3-border.w3-right(id="dislike" + post.uuid onclick='dislike("' + post.uuid + '");', style='margin-bottom: 15px; display:none;')
                                        span.fa.fa-pencil
                                        b &nbsp; &nbsp; DISLIKE
                                else
                                    button.w3-button.w3-padding-large.w3-black.w3-border.w3-right(id="like" + post.uuid onclick='like("' + post.uuid + '");', style='margin-bottom: 15px;display:none;')
                                        span.fa.fa-pencil
                                        b &nbsp; &nbsp; LIKE
                                    button.w3-button.w3-padding-large.w3-black.w3-border.w3-right(id="dislike" + post.uuid onclick='dislike("' + post.uuid + '");', style='margin-bottom: 15px;')
                                        span.fa.fa-pencil
                                        b &nbsp; &nbsp; DISLIKE
                                button.w3-button.w3-padding-large.w3-black.w3-border.w3-left(onclick='deletePost("' + post.uuid + '");', style='margin-bottom: 15px;')
                                    span.fa.fa-pencil
                                    b &nbsp; &nbsp; DELETE POST
        .w3-col.l4
            each post,index in posts
                if(index % 3 == 1)
                    .w3-card-4.w3-white(id="delete" + post.uuid)
                        if(post.foto != 'nothing')
                            img(src= post.foto)
                        p(style="margin-left: 10px; margin-top: 10px;") BY &nbsp;
                            b= post.usuari
                            p(style="margin-left: 20px; margin-top: 10px; font-color: #434343;")= "ON " + dateToYMD(new Date(post.date))
                        if(post.description != 'nothing')
                            .w3-container.w3-center(style="width: 95%")
                                hr
                                b DESCRIPTION
                                p(style='word-wrap: break-word;text-align: left;')= post.description
                                p LIKES:
                                p(id="likes" + post.uuid)= post.likes.low
                                if(post.liked.low == 0)
                                    button.w3-button.w3-padding-large.w3-black.w3-border.w3-right(id="like" + post.uuid onclick='like("' + post.uuid + '");', style='margin-bottom: 15px;')
                                        span.fa.fa-pencil
                                        b &nbsp; &nbsp; LIKE
                                    button.w3-button.w3-padding-large.w3-black.w3-border.w3-right(id="dislike" + post.uuid onclick='dislike("' + post.uuid + '");', style='margin-bottom: 15px; display:none;')
                                        span.fa.fa-pencil
                                        b &nbsp; &nbsp; DISLIKE
                                else
                                    button.w3-button.w3-padding-large.w3-black.w3-border.w3-right(id="like" + post.uuid onclick='like("' + post.uuid + '");', style='margin-bottom: 15px;display:none;')
                                        span.fa.fa-pencil
                                        b &nbsp; &nbsp; LIKE
                                    button.w3-button.w3-padding-large.w3-black.w3-border.w3-right(id="dislike" + post.uuid onclick='dislike("' + post.uuid + '");', style='margin-bottom: 15px;')
                                        span.fa.fa-pencil
                                        b &nbsp; &nbsp; DISLIKE
                                button.w3-button.w3-padding-large.w3-black.w3-border.w3-left(onclick='deletePost("' + post.uuid + '");', style='margin-bottom: 15px;')
                                    span.fa.fa-pencil
                                    b &nbsp; &nbsp; DELETE POST
        .w3-col.l4
            each post,index in posts
                if(index%3==2)
                    .w3-card-4.w3-white(id="delete" + post.uuid)
                        if(post.foto!='nothing')
                            img(src= post.foto)
                        p(style="margin-left: 10px; margin-top: 10px;") BY &nbsp;
                            b= post.usuari
                            p(style="margin-left: 20px; margin-top: 10px; font-color: #434343;")= "ON " + dateToYMD(new Date(post.date))
                        if(post.description!='nothing')
                            .w3-container.w3-center(style="width: 95%")
                                hr
                                b DESCRIPTION
                                p(style='word-wrap: break-word;text-align: left;')= post.description
                                p LIKES:
                                p(id="likes" + post.uuid)= post.likes.low
                                if(post.liked.low == 0)
                                    button.w3-button.w3-padding-large.w3-black.w3-border.w3-right(id="like" + post.uuid onclick='like("' + post.uuid + '");', style='margin-bottom: 15px;')
                                        span.fa.fa-pencil
                                        b &nbsp; &nbsp; LIKE
                                    button.w3-button.w3-padding-large.w3-black.w3-border.w3-right(id="dislike" + post.uuid onclick='dislike("' + post.uuid + '");', style='margin-bottom: 15px; display:none;')
                                        span.fa.fa-pencil
                                        b &nbsp; &nbsp; DISLIKE
                                else
                                    button.w3-button.w3-padding-large.w3-black.w3-border.w3-right(id="like" + post.uuid onclick='like("' + post.uuid + '");', style='margin-bottom: 15px;display:none;')
                                        span.fa.fa-pencil
                                        b &nbsp; &nbsp; LIKE
                                    button.w3-button.w3-padding-large.w3-black.w3-border.w3-right(id="dislike" + post.uuid onclick='dislike("' + post.uuid + '");', style='margin-bottom: 15px;')
                                        span.fa.fa-pencil
                                        b &nbsp; &nbsp; DISLIKE
                                button.w3-button.w3-padding-large.w3-black.w3-border.w3-left(onclick='deletePost("' + post.uuid + '");', style='margin-bottom: 15px;')
                                    span.fa.fa-pencil
                                    b &nbsp; &nbsp; DELETE POST
        //else
            p There are no stories

style.
    /*RESPONSIVE TEXT*/
    .w3-container {
        margin-top: 90px;
        margin-bottom: 20px;
    }

    .w3-container div img{
        max-width: 100%;
        display: inline-block;
        margin: auto;
    }

    .w3-container div{
        vertical-align: top;
        max-width: 25vw;
        display: block;
        margin-left: 2.5%;
        margin-right: 2.5%;
        margin-bottom: 20px;
    }

script.
    function dislike(uuid) {
        $('#spinnerbackground').css('display', 'block');
        $('#spinner').css('display', 'block');
        $.ajax({
            method: "POST",
            url: "/unlike/" + uuid,
            success: function (result) {
                console.log(result);
                $('#spinnerbackground').css('display', 'none');
                $('#spinner').css('display', 'none');
                if (result == "OK") {
                    var mb = $('#likes' + uuid).text();
                    $('#likes' + uuid).text(parseInt(mb) - 1);
                    $('#like' + uuid).css("display", "block");
                    $('#dislike' + uuid).css("display", "none");
                }
                else {
                    //ERROR CARD
                }
            }
        });
    };

    function like(uuid) {
        $('#spinnerbackground').css('display', 'block');
        $('#spinner').css('display', 'block');
        $.ajax({
            method: "POST",
            url: "/like/" + uuid,
            success: function (result) {
                console.log(result);
                $('#spinnerbackground').css('display', 'none');
                $('#spinner').css('display', 'none');
                if (result == "OK") {
                    var mb = $('#likes' + uuid).text();
                    $('#likes' + uuid).text(parseInt(mb) + 1);
                    $('#like' + uuid).css("display", "none");
                    $('#dislike' + uuid).css("display", "block");
                }
                else {
                    //ERROR CARD
                }
            }
        });
    };

    function deletePost(uuid) {
        $('#spinnerbackground').css('display', 'block');
        $('#spinner').css('display', 'block');
        $.ajax({
            method: "POST",
            url: "/deletePost/" + uuid,
            success: function (result) {
                console.log(result);
                $('#spinnerbackground').css('display', 'none');
                $('#spinner').css('display', 'none');
                if (result == "OK") {
                    $('#delete' + uuid).css("display", "none");
                }
                else {
                    //ERROR CARD
                }
            }
        });
    };